---
import Layout from './Layout.astro';
import type { AppError, FetchError } from '../api/api';
import { ProjectNavigation } from '../components/Projects/ProjectNavigation';
import { PageError } from '../components/Errors/PageError';

export interface Props {
  project?: Partial<{
    id: string;
    name: string;
  }>;
  projectError?: AppError | FetchError | null;
  title: string;
  projectId: string;
  identityId?: string;
}

const { project, projectError, identityId, ...props } = Astro.props;
const hasError = !project?.id || !!projectError;
---

<Layout {...props}>
  {
    !hasError && (
      <>
        <ProjectNavigation
          project={{
            id: project?.id!,
            name: project?.name!,
          }}
          url={Astro.url}
          params={{
            projectId: project?.id!,
            identityId,
          }}
        />
        <slot />
      </>
    )
  }
  {
    hasError && (
      <PageError error={projectError?.message || 'Something went wrong'} />
    )
  }
</Layout>
